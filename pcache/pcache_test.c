#include <stdio.h>
#include "pcache.h"

static char *node_list = "10.182.171.1:6379,10.182.171.2:6379,10.182.171.3:6379,10.182.171.4:6379,\
							10.182.171.5:6379,10.182.171.6:6379,10.182.171.7:6379,10.182.171.8:6379,\
							10.182.171.9:6379,10.182.171.10:6379,10.182.171.11:6379,10.182.171.12:6379,\
							10.182.171.13:6379,10.182.171.14:6379,10.182.171.15:6379,10.182.171.16:6379,\
							10.182.171.17:6379,10.182.171.18:6379,10.182.171.19:6379,10.182.171.20:6379,\
							10.182.171.21:6379,10.182.171.22:6379,10.182.171.23:6379,10.182.171.24:6379,\
							10.182.171.25:6379,10.182.171.26:6379,10.182.171.27:6379,10.182.171.28:6379,\
							10.182.171.29:6379,10.182.171.30:6379,10.182.171.31:6379,10.182.171.32:6379,\
							10.182.172.1:6379,10.182.172.2:6379,10.182.172.3:6379,10.182.172.4:6379,\
							10.182.172.5:6379,10.182.172.6:6379,10.182.172.7:6379,10.182.172.8:6379,\
							10.182.172.9:6379,10.182.172.10:6379,10.182.172.11:6379,10.182.172.12:6379,\
							10.182.172.13:6379,10.182.172.14:6379,10.182.172.15:6379,10.182.172.16:6379,\
							10.182.172.17:6379,10.182.172.18:6379,10.182.172.19:6379,10.182.172.20:6379,\
							10.182.172.21:6379,10.182.172.22:6379,10.182.172.23:6379,10.182.172.24:6379,\
							10.182.172.25:6379,10.182.172.26:6379,10.182.172.27:6379,10.182.172.28:6379,\
							10.182.172.29:6379,10.182.172.30:6379,10.182.172.31:6379,10.182.172.32:6379";


int main(int argc, char const *argv[])
{
	struct pcache *pc;
	pc = (struct pcache *)malloc(sizeof(struct pcache));
	pc->hostname = "10.182.171.2";
	pc->port = 6379;
	//pc->timeout = { 1, 500000 }; // 1.5s
	pcache_init(pc);
	char *key = "test";
	char *value = "fuck you";
	char *new_value ="qqqqq";

	int ret;
	redisReply *reply;
	reply = (struct redisReply *)malloc(sizeof(struct redisReply));
	ret = pcache_set(pc, reply, key, value);
	printf("set success\n");
	ret = pcache_get(pc, reply, key);
	printf("get key: %s\n", reply->str);
	ret = pcache_update(pc, reply, key, new_value);
	ret = pcache_get(pc, reply, key);
	printf("get key after update: %s\n", reply->str);
	ret = pcache_del(pc, reply, key);
	printf("get key after del: %s\n", reply->str);
	ret = pcache_free(pc);
	printf("free success\n");

	return 0;
}